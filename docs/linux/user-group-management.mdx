---
sidebar_position: 5
---

# 管理用户和组：构建多用户环境

Linux 从诞生之初就是一个多用户操作系统。这意味着多个用户可以同时登录并使用同一台计算机，而系统能确保每个用户的文件和进程是相互隔离和安全的。这背后就是强大的用户和组管理系统。本教程将教你如何创建、删除和管理用户与用户组。

执行本教程中的大多数命令都需要管理员权限，因此请记得在命令前使用 `sudo`。

## 用户管理

### `useradd` / `adduser`：创建新用户

创建新用户主要有两个命令：`useradd` 和 `adduser`。

-   `useradd`: 是一个底层的、功能更基础的命令。
-   `adduser`: 是一个更友好的、交互式的 Perl 脚本，它在后台调用 `useradd`，并会自动完成创建主目录、设置密码等一系列操作。**对于初学者，强烈推荐使用 `adduser`**。

**使用 `adduser` 创建用户：**

```bash
$ sudo adduser newuser
Adding user `newuser' ...
Adding new group `newuser' (1001) ...
Adding new user `newuser' (1001) with group `newuser' ...
Creating home directory `/home/newuser' ...
Copying files from `/etc/skel' ...
New password:  # 在这里输入新密码
Retype new password: # 再次输入密码
passwd: password updated successfully
Changing the user information for newuser
Enter the new value, or press ENTER for the default
	Full Name []: New User
	Room Number []:
	Work Phone []:
	Home Phone []:
	Other []:
Is the information correct? [Y/n] Y
```
`adduser` 会引导你完成所有步骤，非常方便。

**使用 `useradd` 创建用户（更手动的方式）：**

```bash
# 只创建一个用户，没有主目录，没有密码
$ sudo useradd anotheruser

# 创建用户的同时创建主目录 (-m)
$ sudo useradd -m anotheruser

# 创建用户，创建主目录，并指定其所属的主要组
$ sudo useradd -m -g users anotheruser
```
使用 `useradd` 后，你还需要手动为用户设置密码。

### `passwd`：设置和修改密码

`passwd` 命令用于为用户设置或更改密码。

```bash
# 为新用户设置密码
$ sudo passwd newuser
New password:
Retype new password:
passwd: password updated successfully

# 如果你以普通用户身份运行，不带用户名，则是修改自己的密码
$ passwd
Changing password for tamochii.
(current) UNIX password:
New password:
Retype new password:
passwd: password updated successfully
```

### `usermod`：修改用户信息

`usermod` (User Modify) 是一个功能强大的命令，用于修改已存在用户的各种属性。

-   `-l` (login): 修改用户名。
-   `-d` (directory): 修改用户的主目录。
-   `-g` (group): 修改用户的主要用户组。
-   `-G` (Groups): 将用户添加到一个或多个**附加**用户组。
-   `-aG`: `-a` (append) 配合 `-G`，表示**追加**用户到附加组，而不是覆盖。**这非常重要！**

**示例：**

```bash
# 将用户 newuser 添加到 sudo 组，使其拥有管理员权限
$ sudo usermod -aG sudo newuser

# 将用户 newuser 的主目录移动到新位置
$ sudo usermod -d /new/home/newuser -m newuser

# 更改用户 newuser 的登录名为 olduser
$ sudo usermod -l olduser newuser
```

### `userdel` / `deluser`：删除用户

与创建用户类似，删除用户也有两个命令：`userdel` 和 `deluser`。同样，`deluser` 更友好。

-   `userdel`: 底层命令。
-   `deluser`: 推荐使用的脚本。

**使用 `deluser` 删除用户：**

```bash
# 只删除用户，保留其主目录
$ sudo deluser olduser

# 删除用户的同时，删除其主目录和邮件池
$ sudo deluser --remove-home olduser
```

## 用户组管理

用户组是管理权限的有效方式。你可以为一个用户组设置权限，然后将需要这些权限的用户都加入到这个组里，而无需为每个用户单独设置。

### `groupadd`：创建新组

```bash
$ sudo groupadd developers
```

### `groupmod`：修改用户组

```bash
# 重命名用户组 (-n)
$ sudo groupmod -n devs developers
```

### `groupdel`：删除用户组

```bash
$ sudo groupdel devs
```
注意：你不能删除一个作为任何用户主要用户组的组。必须先将这些用户的基本用户组改掉。

## 查看信息

### `/etc/passwd`

这个文件存储了系统中所有用户的信息（除了密码）。每一行代表一个用户。

```bash
$ cat /etc/passwd
root:x:0:0:root:/root:/bin/bash
...
tamochii:x:1000:1000:Tamo Chii,,,:/home/tamochii:/bin/bash
newuser:x:1001:1001:New User,,,:/home/newuser:/bin/bash
```
每行由冒号 `:` 分隔成 7 个字段，分别是：
1.  用户名
2.  密码占位符 (`x` 表示密码存储在 `/etc/shadow` 文件中)
3.  用户 ID (UID)
4.  主要用户组 ID (GID)
5.  用户描述信息
6.  主目录路径
7.  默认 Shell

### `/etc/group`

这个文件存储了所有用户组的信息。

```bash
$ cat /etc/group
root:x:0:
...
sudo:x:27:tamochii,newuser
users:x:100:
developers:x:1002:
```
每行由冒号 `:` 分隔成 4 个字段：
1.  用户组名
2.  用户组密码占位符
3.  用户组 ID (GID)
4.  组成员列表（以逗号分隔）

### `id` 命令

`id` 命令可以方便地查看指定用户（或当前用户）的 UID、GID 和所属的所有用户组。

```bash
$ id newuser
uid=1001(newuser) gid=1001(newuser) groups=1001(newuser),27(sudo)
```

## 结语

理解和掌握用户与组的管理是 Linux 系统管理的基础。通过合理地创建用户和分配组，你可以构建一个安全、有序、易于协作的多用户环境。这对于无论是个人桌面使用还是管理团队服务器都至关重要。

在下一篇教程中，我们将学习如何管理系统中的软件，包括安装、更新和卸载应用程序。
